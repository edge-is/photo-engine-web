var search=angular.module("search",["siyfion.sfTypeahead","ui.bootstrap","ngRoute","nemLogging","leaflet-directive","cfp.hotkeys","ui.select","ngSanitize"]);search.config(["$routeProvider","$locationProvider","uiSelectConfig",function(a,b,c){c.theme="bootstrap",b.html5Mode({enabled:!0,requireBase:!1})}]);var settings={search:{fields:{BitsPerSample:{type:"long"},CaptionWriter:{type:"string"},Category:{type:"string"},City:{type:"string"},ColorComponents:{type:"long"},ColorMode:{type:"string"},Comment:{type:"string"},Country:{type:"string"},Credit:{type:"string"},DateCreated:{type:"date"},Description:{type:"string"},Directory:{type:"string"},ExifImageHeight:{type:"long"},ExifImageWidth:{type:"long"},FileName:{type:"string"},FileType:{type:"string"},ImageHeight:{type:"long"},ImageWidth:{type:"long"},Instructions:{type:"string"},Keywords:{type:"string"},LocalCaption:{type:"string"},MIMEType:{type:"string"},ObjectName:{type:"string"},Orientation:{type:"string"},PhotometricInterpretation:{type:"string"},ProfileFileSignature:{type:"string"},ReleaseDate:{type:"date"},Rights:{type:"string"},Source:{type:"string"},SourceFile:{type:"string"},SpecialInstructions:{type:"string"},State:{type:"string"},Subject:{type:"array"},SupplementalCategories:{type:"array"},Title:{type:"string"},XResolution:{type:"long"},YResolution:{type:"long"},safn:{type:"string"}}}};search.controller("AdvancedSearchController",["$scope","$modalInstance","data","translate",function(a,b,c,d){var e=function(){return{bool:"AND",key:"",operator:"==",query:""}};a.advanced_search_query=[new e],a.advanced_search_fields=[],$.each(settings.search.fields,function(b,c){var e=d(b),f=b;e&&(f=e.name),a.advanced_search_fields.push({name:f,key:b})}),a.advanced_search_add=function(b){a.advanced_search_query.push(new e)},a.advanced_search_remove=function(b){a.advanced_search_query.splice(b,1)},a.search=function(){console.log(a.advanced_search_query)},a.close=function(){b.dismiss()}}]),search.controller("ImageController",["$scope","$location","$modalInstance","data","map","hotkeys",function(a,b,c,d,e,f){function g(b){(document.webkitIsFullScreen===!1||document.mozFullScreen===!1||null===document.msFullscreenElement)&&(a.isFullscreen=!1,a.fullscreenClass="no-fullscreen")}a.index=d.index,a.images=d.results,a.image=d.image,a.isFullscreen=!1,a.fullscreenClass="no-fullscreen",a.close=function(){c.dismiss()},a.nextImg=a.images[a.index+1],a.prevImg=a.images[a.index-1],a.next=function(){a.index+1<a.images.length&&(a.StopLazy(),a.index=a.index+1,a.image=a.images[a.index],a.nextImg=a.images[a.index])},a.prev=function(){a.index>0&&(a.StopLazy(),a.index=a.index-1,a.image=a.images[a.index],a.prevImg=a.images[a.index])},a.nextURL=function(){return a.nextImg?"/image/"+a.nextImg._id:void 0},a.prevURL=function(){return a.prevImg?"/image/"+a.prevImg._id:void 0},a.isNext=function(){var b=a.images.length;return a.index+1>=b?!1:!0},a.isPrev=function(){return 0==a.index?!1:!0},a.landscape=function(a){return a._source.ImageWidth<a._source.ImageHeight?!1:!0},a.TMPselectImg=function(a,b){var c="";return c="low"==b?"medium":"high"==b?"xx-large":"medium",a._source.ImageWidth<a._source.ImageHeight?"img/scaled/"+c+"_uf-2.jpg":"img/scaled/"+c+"_uf-1.jpg"},a.StopLazy=function(){$(".high-resolution-image").unbind("load")};var h="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";$(document).on(h,g),a.fullscreen=function(){var b=document.getElementById("preview_carousel");b.requestFullscreen?b.requestFullscreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.msRequestFullscreen&&b.msRequestFullscreen(),a.fullscreenClass="fullscreen",a.isFullscreen=!0},f.bindTo(a).add({combo:"right",description:"Select next image.",callback:function(){a.next()}}).add({combo:"left",description:"Select prev image",callback:function(){a.prev()}}),a.center={},a.defaults={scrollWheelZoom:!1},a.mapmarker={},a.Map=function(){a.MapLoaded=!1;var b={},c=!1;"City"in a.image._source?(c=!0,b.city=a.image._source.City):"State"in a.image._source&&(c=!0,b.state=a.image._source.State),"Country"in a.image._source&&a.image._source.Country.split(" ").length<=2&&(b.Country=a.image._source.Country),1==c&&e.osm(b).then(function(b){b.length>0&&(a.MapLoaded=!0,a.center={lat:+b[0].lat,lng:+b[0].lon,zoom:4},a.mapmarker={m1:{lat:+b[0].lat,lng:+b[0].lon,message:"Wazzuuup?",icon:"img/map-marker.png"}})})}}]),search.controller("main",["$scope","$window","_search","$uibModal","$log","$location",function(a,b,c,d,e,f){function g(a){return 400>a?"small":a>=600&&900>=a?"medium":a>=900?"large":void 0}function h(b,d){angular.element("#mainsearch").focus(),a.MainSearchHidden=!1,a.StartSearchHidden=!0,angular.element("body")[0].scrollTop=0,c.query(a.MainSearchQuery,{}).then(function(b){a.searchTime=b.data._took,a.searchResultsTotal=b.data._total,a.MainSearchHits=b.data.hits}),a.lastSearchURI=f.$$url}a.MainSearchHidden=!0,a.MainSearch="",a.StartSearch="",a.typeaheadquery="",a.searchTime=0,a.searchResultsTotal=0,a.MainSearchHits=[];var i=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.num)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"http://localhost:3000/api/search/typeahead?query={query}*",wildcard:"{query}",filter:function(a){return a.data.hits}}});i.clear(),i.initialize(),a.TypeaheadEngineData={displayKey:"hit",source:i.ttAdapter()},a.TypeaheadOptions={highlight:!0},a.MainSearchQuery=f.search().query||"",a.MainSearchFilter=f.search().filter||"",(""!==a.MainSearchQuery||""!==a.MainSearchFilter)&&(setTimeout(function(){a.MainSearch=a.MainSearchQuery},100),h(a.MainSearchQuery)),a.$watch("StartSearch",function(b,c){a.StartSearch.length>0&&(angular.element("#mainsearch").focus(),a.MainSearchHidden=!1,setTimeout(function(){a.StartSearchHidden=!0},20)),a.MainSearch=a.StartSearch}),a.submitMainSearch=function(){a.MainSearch.hit?a.MainSearchQuery=a.MainSearch.hit:a.MainSearchQuery=a.MainSearch,a.setURI(),h(a.MainSearchQuery)},a.setURI=function(){var b={};""!==a.MainSearchQuery&&(b.query=a.MainSearchQuery),""!==a.MainSearchFilter&&(b.filter=a.MainSearchFilter),f.search(b)},a.$on("typeahead:selected",function(b,c,d){a.MainSearch.hit?a.MainSearchQuery=a.MainSearch.hit:a.MainSearchQuery=a.MainSearch,a.setURI(),h(a.MainSearchQuery)}),a.landscape=function(a){return a._source.ImageWidth<a._source.ImageHeight?!1:!0};var j=angular.element(b);a.windowWidth=j.width(),a.DefaultImage=g(a.windowWidth),a.openImage=function(b,c,e){var g=d.open({templateUrl:"views/image-modal.html",controller:"ImageController",size:"lg",resolve:{data:function(){return{index:b,image:c,results:e}}}});g.result.then(function(a){},function(){f.url(a.lastSearchURI)})},a.openAdvancedSearch=function(b,c,e){var g=d.open({templateUrl:"views/advanced-search-modal.html",controller:"AdvancedSearchController",size:"lg",resolve:{data:function(){return{}}}});g.result.then(function(a){},function(){f.url(a.lastSearchURI)})}}]),search.directive("lazyimg",function(){return{restrict:"ACE",template:function(a,b){return console.log(b.lowres),'<img class="low-resolution-image" ng-src="'+b.lowres+'"></img><img class="hidden high-resolution-image" ng-src="'+b.highres+'"></img>'},link:function(a,b,c){$(".high-resolution-image").bind("load",function(){$(".low-resolution-image").addClass("hidden"),$(".high-resolution-image").removeClass("hidden").unbind("load")})}}}),search.filter("ms",[function(){return function(a){var b=a/1e3;return b+"s"}}]),search.filter("propsFilter",function(){return function(a,b){var c=[];return angular.isArray(a)?a.forEach(function(a){for(var d=!1,e=Object.keys(b),f=0;f<e.length;f++){var g=e[f],h=b[g].toLowerCase();if(-1!==a[g].toString().toLowerCase().indexOf(h)){d=!0;break}}d&&c.push(a)}):c=a,c}}),search.service("_search",["$http","$q",function(a,b){return{typeahead:function(a){},filter:function(a){},query:function(c,d){d||(d={});var e=d.limit||30,f=d.offset||0,g=b.defer(),h=[config.api,"/search/query?"].join("");return h+="limit="+e,h+="&offset="+f,h+="&query="+c,a.get(h).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise}}}]),search.service("map",["$http","$q",function(a,b){return{osm:function(c){var d=b.defer(),e={url:"https://nominatim.openstreetmap.org/search.php",method:"GET",params:c};return e.params.format="json",a(e).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}}}]),search.service("translate",[function(){return function(a){if("lang"in window==!1)return{name:a};if(a in lang){var b=lang[a];return""!==b.name?b:{name:a}}return{name:a}}}]);
//# sourceMappingURL=application.min.js.map